{"version":3,"sources":["UserMgr.js"],"names":["cc","Class","extends","Component","properties","account","userid","avatar","userName","roomid","ip","sign","isSitDown","login","vv","socket","addHandler","msg","roomNum","args","userMgr","enterRoom","director","getScene","name","loadScene","uitools","ShowAlert","LOCALHOST","hallSDK","goHall","window","parent","location","self","onLogin","ret","errcode","data","clientip","port","clientport","gameNetMgr","connectGameServer","http","sendRequest","gameId","undefined","str","encodeURIComponent","json","decodeURIComponent","JSON","parse","preloadScene","Grobal","onRoomJoin","uid","conf","inningsNum","send"],"mappings":"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","file":"UserMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\mgr","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        account:null,\r\n        userid:null,\r\n        avatar:null,\r\n        userName:null,\r\n        roomid:null,\r\n        ip:null,\r\n        sign:0,\r\n        isSitDown:false,\r\n    },\r\n\r\n    login:function(){\r\n        cc.vv.socket.addHandler('welcome', function(msg){\r\n           var roomNum = cc.args[\"roomNum\"];\r\n           if(roomNum == null){roomNum = 1}\r\n           cc.vv.userMgr.enterRoom(roomNum);\r\n        });\r\n        cc.vv.socket.addHandler('joinRoom', function(msg){\r\n            if(cc.director.getScene().name==\"game12\"||cc.director.getScene().name==\"game6\"||cc.director.getScene().name==\"game9\"){\r\n\r\n            }else{\r\n                cc.director.loadScene(\"game\"+cc.args[\"ext_json\"]['playerNum']);\r\n            }\r\n        });\r\n        cc.vv.socket.addHandler('joinRoom_error', function(msg){\r\n            cc.vv.uitools.ShowAlert(cc.director.getScene(),msg,function(){\r\n                if(!cc.LOCALHOST){\r\n                    cc.vv.hallSDK.goHall();\r\n                }else{\r\n                    window.parent.location=\"/\";\r\n                }\r\n            },false);       \r\n        });\r\n\r\n        var self = this;\r\n        var onLogin = function(ret){\r\n            if(ret.errcode !== 0){\r\n            }else{\r\n                    var data = {\r\n                        ip:ret.clientip,\r\n                        port:ret.clientport,\r\n                    };\r\n                    cc.vv.gameNetMgr.connectGameServer(data);\r\n            }\r\n        }\r\n        cc.vv.http.sendRequest(\"/login\",{account:self.account,gameId:cc.args['gameId'],roomNum:cc.args['roomNum'],sign:self.sign},onLogin)\r\n    },\r\n\r\n    enterRoom:function(roomid){\r\n        if(cc.args[\"ext\"] == undefined){\r\n            var str = \"{\\\"niu7\\\":\\\"bei2\\\",\\\"teshu\\\":\\\"dayu3\\\",\\\"zhuangType\\\":\\\"turn\\\",\\\"playType\\\":\\\"see\\\",\\\"difen\\\":\\\"5\\\",\\\"playerNum\\\":\\\"9\\\"}\";\r\n            cc.args[\"ext\"] = encodeURIComponent(str);\r\n        }\r\n        if(cc.args[\"inningsNum\"] == undefined){\r\n            cc.args[\"inningsNum\"] = 4;\r\n        }\r\n        var json = decodeURIComponent(cc.args[\"ext\"]);\r\n        cc.args[\"ext_json\"] = JSON.parse(json)\r\n        if(cc.args[\"ext_json\"]['playerNum']==undefined){\r\n            cc.args[\"ext_json\"]['playerNum'] = 6;\r\n        }\r\n        cc.director.preloadScene(\"game\"+cc.args[\"ext_json\"]['playerNum']);\r\n        Grobal.roomNum = roomid;\r\n        cc.vv.gameNetMgr.onRoomJoin();\r\n        var data = {\r\n            uid:Grobal.uid,\r\n            userName:cc.args[\"userName\"],\r\n            avatar:cc.args[\"avatar\"],\r\n            roomNum:Grobal.roomNum,\r\n            conf:cc.args[\"ext\"],\r\n            inningsNum:cc.args[\"inningsNum\"],\r\n        };\r\n        cc.vv.socket.send('joinRoom',data);\r\n    },\r\n});\r\n"]}