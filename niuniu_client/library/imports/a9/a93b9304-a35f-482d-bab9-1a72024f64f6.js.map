{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\logic/assets\\scripts\\logic\\GamePlay.js"],"names":["clone","obj","Date","copy","setTime","getTime","Array","i","length","Object","attr","hasOwnProperty","Error","cc","Class","extends","Component","properties","poker","default","type","Prefab","myNode","Node","readyBtn","Button","backPrefab","_backPrefabPool","_clickTimeArray","_voiceMsgQueue","_lastPlayTime","_voice_btn","_playingSeat","onLoad","view","setDesignResolutionSize","NodePool","_pokerSpriteFrameMap","self","active","node","on","EventType","TOUCH_START","readyCallBack","Grobal","numOfGame","find","getComponent","Label","string","maxOfGame","loader","loadRes","SpriteAtlas","err","assets","sflist","getSpriteFrames","sf","_name","pokerSpriteFrameMap","userNames","vv","gameNetMgr","playerList","p","uid","userName","init","audioMgr","playBGM","dispatchEvent","getIsOpen","pokerPrefab","status","checkPlayerStatus","readyCount","seatIndex","netRoot","msgBean","uitools","ClearTime","director","getScene","msg","userMgr","enterRoom","roomNum","LOCALHOST","result","hallSDK","goResult","ShowLayer","detail","allPokers","myNodeScript","displayAndClickPokers","showSelectNiu","displayPokers","showQiangZhuan","playSFX","isGrab","socket","send","time","getChildByName","undefined","removeFromParent","reset","update","dt","now","onPlayerOver","playVoice"],"mappings":"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","file":"GamePlay.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\logic","sourcesContent":["\r\nfunction clone(obj) {\r\n  if (null == obj || \"object\" != typeof obj) return obj;\r\n  if (obj instanceof Date) {\r\n    var copy = new Date();\r\n    copy.setTime(obj.getTime());\r\n    return copy;\r\n  }\r\n  if (obj instanceof Array) {\r\n    var copy = [];\r\n    for (var i = 0; i < obj.length; ++i) {\r\n      copy[i] = clone(obj[i]);\r\n    }\r\n    return copy;\r\n  }\r\n  if (obj instanceof Object) {\r\n    var copy = {};\r\n    for (var attr in obj) {\r\n      if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);\r\n    }\r\n    return copy;\r\n  }\r\n  throw new Error(\"Unable to copy obj! Its type isn't supported.\");\r\n}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        poker: {\r\n           default: null,\r\n           type: cc.Prefab\r\n        },\r\n        myNode: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        readyBtn: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n        backPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        _backPrefabPool: null,\r\n        _clickTimeArray: null,\r\n         _voiceMsgQueue:[],\r\n         _lastPlayTime:null,\r\n         _voice_btn:{\r\n            default:null,\r\n            type:cc.Button\r\n        },\r\n        _playingSeat:null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        cc.view.setDesignResolutionSize(640, 1024, 0);\r\n        this._backPrefabPool = new cc.NodePool();\r\n        this._pokerSpriteFrameMap = {};\r\n        this._clickTimeArray = new Array();\r\n        var _pokerSpriteFrameMap = this._pokerSpriteFrameMap;\r\n        var self = this;\r\n\t\tthis.myNode.active = true;\r\n        //出牌按钮注册\r\n        this.readyBtn.node.on(cc.Node.EventType.TOUCH_START, this.readyCallBack, this);\r\n\r\n        if(Grobal.numOfGame==0){\r\n            cc.find(\"Canvas/room_bg/roomjushu\").getComponent(cc.Label).string=\"1 / \"+Grobal.maxOfGame+\" 局\";\r\n        }else{\r\n            cc.find(\"Canvas/room_bg/roomjushu\").getComponent(cc.Label).string=\"\"+Grobal.numOfGame+\" / \"+Grobal.maxOfGame+\" 局\";\r\n        }\r\n        \r\n        cc.loader.loadRes(\"comm/pokers\", cc.SpriteAtlas, function (err, assets) {\r\n            var sflist = assets.getSpriteFrames();\r\n            for(var i = 0; i < sflist.length; i++){\r\n                var sf = sflist[i];\r\n                _pokerSpriteFrameMap[sf._name] = sf;\r\n                Grobal.pokerSpriteFrameMap = _pokerSpriteFrameMap\r\n            }\r\n            if(Grobal.numOfGame==0){\r\n                var userNames =\"\"\r\n                for(var i=0;i<cc.vv.gameNetMgr.playerList.length;++i){\r\n                    var p = cc.vv.gameNetMgr.playerList[i];\r\n                    if(p.uid==Grobal.uid){\r\n                        continue;\r\n                    }\r\n                    if(userNames==\"\"){\r\n                        userNames =userNames+p.userName;\r\n                    }else{\r\n                        userNames =userNames+\"、\"+p.userName;\r\n                    }\r\n                }\r\n                if(userNames!=\"\"){\r\n                    self.init();\r\n                }else{\r\n                    self.init();   \r\n                }\r\n            }else{\r\n                self.init();   \r\n            }\r\n        });\r\n        cc.vv.audioMgr.playBGM(\"bgm_room_1.mp3\");\r\n    },\r\n\r\n    init: function(){\r\n        cc.vv.gameNetMgr.dispatchEvent('game_play_init_over',true);\r\n\t\tthis.myNode.active = false;\r\n        var self = this;\r\n\r\n        if(cc.vv.gameNetMgr.getIsOpen()){\r\n            self.readyBtn.node.active = false;\r\n        }\r\n        this._voice_btn = cc.find(\"Canvas/gameview/voiceBtn\").getComponent(cc.Button);\r\n        var pokerPrefab = this.poker;\r\n        \r\n        if(Grobal.status!=\"standup\" || Grobal.status!=\"ready\"){\r\n\t\t   self.checkPlayerStatus(); \r\n        }\r\n        if(Grobal.numOfGame == 0){\r\n            if(cc.vv.gameNetMgr.readyCount >= 2){\r\n                if(Grobal.seatIndex == 0){\r\n                }\r\n            }\r\n        }\r\n        cc.vv.netRoot.on('game_restart',function(msgBean){\r\n            self.readyBtn.node.active = true;\r\n            if(Grobal.numOfGame==Grobal.maxOfGame){\r\n                self.readyCallBack();\r\n            }\r\n            cc.vv.uitools.ClearTime(cc.director.getScene());\r\n        },this);\r\n        cc.vv.netRoot.on('game_restart_notice',function(msgBean){\r\n             self.readyBtn.node.active = true;\r\n        },this);  \r\n        cc.vv.netRoot.on('reconnect_update',function(msg){\r\n            cc.vv.userMgr.enterRoom(Grobal.roomNum);\r\n            self.checkPlayerStatus(); \r\n        },this);\r\n        cc.vv.netRoot.on('gameplayTimeout',function(msgBean){\r\n            self.readyCallBack();\r\n        },this);\r\n\r\n        cc.vv.netRoot.on('single_game_finish',function(msg){\r\n            if(!cc.LOCALHOST){\r\n                var result = cc.vv.hallSDK.goResult(); \r\n                if (!result) {\r\n                    cc.vv.uitools.ShowLayer(\"GameFinishUI\",self.node,msg.detail);\r\n                }\r\n            }else{\r\n                cc.vv.uitools.ShowLayer(\"GameFinishUI\",self.node,msg.detail);\r\n            }\r\n        },this);\r\n\r\n        cc.vv.netRoot.on('user_state_dealingCards',function(msgBean){\r\n            cc.find(\"Canvas/room_bg/roomjushu\").getComponent(cc.Label).string=\"\"+Grobal.numOfGame+\" / \"+Grobal.maxOfGame+\" 局\";\r\n            self.readyBtn.node.active = false;\r\n\t\t\tif(Grobal.allPokers.length>0){\r\n\t\t\t\tvar myNodeScript = self.myNode.getComponent('Control');\r\n\t\t\t\t//myNodeScript.showSelectNiu()\r\n\t\t\t\tmyNodeScript.displayAndClickPokers(clone(Grobal.allPokers));\r\n\t\t\t\tself.myNode.active = true;\r\n\t\t\t}\r\n        },this);\r\n\r\n        cc.vv.netRoot.on('user_dealingTheFiveCards',function(msgBean){\r\n            self.readyBtn.node.active = false;\r\n\t\t\tif(Grobal.allPokers.length>0){\r\n\t\t\t\tvar myNodeScript = self.myNode.getComponent('Control');\r\n\t\t\t\tmyNodeScript.showSelectNiu()\r\n\t\t\t\tmyNodeScript.displayPokers(clone(Grobal.allPokers),false);\r\n\t\t\t\tself.myNode.active = true;\r\n\t\t\t}\r\n        },this);\r\n\r\n        cc.vv.netRoot.on('user_dealingTheFourCards',function(msgBean){\r\n            self.readyBtn.node.active = false;\r\n\t\t\tif(Grobal.allPokers.length>0){\r\n\t\t\t\tvar myNodeScript = self.myNode.getComponent('Control');\r\n\t\t\t\tmyNodeScript.displayPokers(clone(Grobal.allPokers),false);\r\n\t\t\t\tself.myNode.active = true;\r\n\t\t\t}\r\n        },this);\r\n\r\n        cc.vv.netRoot.on('start_qiang_zhuang',function(msgBean){\r\n            if(Grobal.status == \"standup\" ||Grobal.status == \"ready\"){\r\n                self.readyBtn.node.active = false;\r\n                cc.vv.gameNetMgr.dispatchEvent('show_tips_message',\"请等待下一局\");\r\n                return\r\n            }\r\n            self.readyBtn.node.active = false;\r\n            var myNodeScript = self.myNode.getComponent('Control');\r\n            myNodeScript.showQiangZhuan();\r\n            cc.vv.audioMgr.playSFX('effect/room_start_compare.mp3');\r\n            self.myNode.active = true;\r\n            cc.vv.gameNetMgr.dispatchEvent('show_tips_message',\"抢庄\");\r\n        },this);\r\n\t\t\r\n\t\tcc.vv.netRoot.on('shezhi_beishu',function(msgBean){\r\n            if(Grobal.status == \"standup\" ||Grobal.status == \"ready\"){return}\r\n            self.readyBtn.node.active = false;\r\n\t\t\tif(Grobal.isGrab == true){   \r\n\t\t\t\tcc.vv.gameNetMgr.dispatchEvent('show_tips_message',\"等待闲家下注\");\r\n\t\t\t}else{\r\n\t\t\t\tcc.vv.gameNetMgr.dispatchEvent('show_tips_message',\"请下注\");\r\n\t\t\t}\r\n\t\t},this);\t\r\n    },\r\n    checkPlayerStatus: function(){\r\n        cc.vv.socket.send('checkPlayerStatus', {roomNum:Grobal.roomNum});\r\n    },\r\n\r\n\r\n    readyCallBack: function(){\r\n        var time = this.node.getChildByName(\"Time\");\r\n        if(time!=undefined&&time!=null){\r\n            time.removeFromParent();\r\n        }\r\n        cc.vv.socket.send('ready',{uid:Grobal.uid,roomNum:Grobal.roomNum});\r\n        var myNodeScript = this.myNode.getComponent('Control');\r\n        myNodeScript.reset();\r\n        this.readyBtn.node.active = false;\r\n    },\r\n\r\n\r\n    update: function (dt) {\r\n        if(this._lastPlayTime != null){\r\n            if(Date.now() > this._lastPlayTime + 1000){\r\n                this.onPlayerOver();\r\n                this._lastPlayTime = null;    \r\n            }\r\n        }else{\r\n\t\t\tif(this._voiceMsgQueue.length>0){\r\n\t\t\t\tthis.playVoice();\r\n\t\t\t}\r\n        }\r\n    },\r\n});\r\n"]}