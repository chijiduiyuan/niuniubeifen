{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\logic/assets\\scripts\\logic\\Loading.js"],"names":["cc","Class","extends","Component","properties","tipLabel","Label","_tipStr","_isloading","_progress","_lasttime","_load","onLoad","view","setDesignResolutionSize","initConfig","self","vv","http","require","loader","load","url","raw","err","res","LOCALHOST","localhost","console","log","location","hostname","sys","isNative","VERSION","version","LocalGameId","localGameId","LocalGameNum","localGameNum","initMgr","socket","AudioMgr","audioMgr","init","UserMgr","userMgr","gameNetMgr","undefined","GameNetMgr","root","find","dataEventHandler","netRoot","UI","uitools","ShowAlert","director","getScene","window","parent","href","hallPlay","hall_config","gameId","args","urlParse","json","decodeURIComponent","JSON","parse","wanfa","wanfas","split","stringify","hallSDK","hall_api","_tips","_tipLabel","getComponent","startPreLoading","ShowTips","msg","active","string","process","Grobal","uid","num","Math","floor","random","toString","backRoom","login","on","detail","params","name","value","str","indexOf","substr","arr","i","length","substring"],"mappings":"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","file":"Loading.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\logic","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tipLabel:cc.Label,\n        _tipStr:'1',\n        _isloading:false,\n        _progress:0.0,\n\n        _lasttime:0,\n        _load:0,\n    },\n\n    onLoad: function () {\n        cc.view.setDesignResolutionSize(640, 1024, 0);\n        this.initConfig();\n    },\n\n    initConfig:function(){\n        var self =this;\n        cc.vv = {}\n        cc.vv.http = require(\"../utils/HTTP\");\n        cc.loader.load(cc.url.raw('resources/config.json'), function(err,res){  \n            if (err) {\n            }else{  \n                cc.LOCALHOST = res.localhost;\n                console.log('------------');\n                console.log(location.hostname);\n                if (res.localhost == 'auto') {\n                    if (!cc.sys.isNative && location && (location.hostname == 'localhost' || location.hostname == '127.0.0.1')) {\n                        cc.LOCALHOST = true;\n                    } else {\n                        cc.LOCALHOST = false;\n                    }\n                }\n                cc.vv.http.url = res.http;\n                cc.VERSION = res.version;\n                cc.LocalGameId = res.localGameId;\n                cc.LocalGameNum = res.localGameNum\n                self.initMgr();\n            }  \n        }); \n    },\n\n    initMgr:function(){\n        cc.vv.socket = require(\"../utils/Socket\");\n\n        var AudioMgr = require(\"../mgr/AudioMgr\");\n        cc.vv.audioMgr = new AudioMgr();\n        cc.vv.audioMgr.init();\n\n        var UserMgr = require(\"../mgr/UserMgr\");\n        cc.vv.userMgr = new UserMgr();\n\n        if(cc.vv.gameNetMgr == undefined){\n            var GameNetMgr = require(\"../mgr/GameNetMgr\");\n            cc.vv.gameNetMgr = new GameNetMgr();\n        }\n        var root = cc.find(\"root\");\n        cc.vv.gameNetMgr.dataEventHandler = root;\n        cc.vv.netRoot = root;\n\n        var UI = require(\"../comp/UI\");\n        cc.vv.uitools = new UI();\n\n        if(cc.LOCALHOST == undefined || cc.VERSION == undefined ){\n            cc.vv.uitools.ShowAlert(cc.director.getScene(),\"配置加载失败，请重进\",function(){\n                window.parent.location.href=\"/\";\n            },false);\n        }\n        \n        if(!cc.LOCALHOST){\n            cc.vv.hallPlay=hall_config;\n        }else{\n            cc.vv.hallPlay={};\n        }\n        //console.log(cc.vv.hallPlay);\n        //console.log(cc.vv.hallPlay.gameId);\n        if(cc.vv.hallPlay.gameId != ''){\n            cc.args = cc.vv.hallPlay;\n        }else{\n            cc.args = this.urlParse();\n        }\n         if(cc.args[\"ext\"]!=undefined){\n            var json = decodeURIComponent(cc.args[\"ext\"]);\n            cc.args[\"ext_json\"] = JSON.parse(json)\n            var wanfa = cc.args[\"ext_json\"]['wanfa'];\n            if(wanfa !== null){\n                var wanfas = wanfa.split(\"_\");\n                cc.args[\"ext_json\"]['playType']=wanfas[0];\n                cc.args[\"ext_json\"]['zhuangType']=wanfas[1];\n            }\n            cc.args[\"ext\"] = JSON.stringify(cc.args[\"ext_json\"]);\n        }\n        if(!cc.LOCALHOST){\n            cc.vv.hallSDK = hall_api;\n            cc.vv.hallSDK.init('{\"uid\":\"'+cc.args[\"uid\"]+'\",\"gameId\":\"'+cc.args[\"gameId\"]+'\",\"roomNum\":\"'+cc.args[\"roomNum\"]+'\"}');\n        }\n        if(cc.args == undefined){cc.args = {}}\n        this._tips =  cc.find(\"Canvas/nettips\");\n        this._tipLabel = this._tips.getComponent(cc.Label);\n        this.startPreLoading();\n    },\n\n    ShowTips:function(msg){\n        var self = this;\n        if(msg == null){\n            self._tips.active = false\n        }else{\n            self._tips.active = true\n            self._tipLabel.string = msg;\n        }\n    },\n\n    startPreLoading:function(){\n        this._tipStr = \"正在加载资源，请稍候\";\n        this._isloading = true;\n        var self = this;\n        var process = 1;\n        if(cc.args[\"uid\"] !== undefined){\n            Grobal.uid = cc.args[\"uid\"];\n        }else{\n            if(cc.LOCALHOST){\n                var num = Math.floor(Math.random() *100) + 100;\n                Grobal.uid = num.toString();\n                cc.args[\"uid\"] = Grobal.uid;\n                cc.args[\"userName\"] = Grobal.uid;\n                if(cc.args[\"gameId\"] == undefined){\n                    cc.args['gameId'] = cc.LocalGameId;\n                }\n                if(cc.args[\"roomNum\"] == undefined){\n                    cc.args['roomNum'] = cc.LocalGameNum;\n                }\n            }else{\n\n            }\n        }\n        \n       if(cc.args[\"uid\"] == undefined||cc.args[\"uid\"] == null){\n            cc.vv.uitools.ShowAlert(cc.director.getScene(),\"网络问题,请刷新重进\",function(){\n                if(cc.LOCALHOST){\n                    window.parent.location.href=\"/\";\n                }else{\n                    cc.vv.hallSDK.backRoom(cc.args[\"roomNum\"]);\n                }\n            },false);\n       }else{\n            cc.vv.userMgr.login();\n        }\n        cc.vv.netRoot.on('show_tips_message',function(msg){\n        self.ShowTips(msg.detail);\n        },this);\n    },\n\n\n\n    urlParse:function(){\n        var params = {};\n        if(window.location == null){\n            return params;\n        }\n        var name,value; \n        var str=window.location.href; \n        var num=str.indexOf(\"?\") \n        var href = str.substr(0,num)\n        str=str.substr(num+1); \n        \n        var arr=str.split(\"&\"); \n        for(var i=0;i < arr.length;i++){ \n            num=arr[i].indexOf(\"=\"); \n            if(num>0){ \n                name=arr[i].substring(0,num);\n                value=arr[i].substr(num+1);\n                params[name]=value;\n            } \n        }\n        params[\"href\"]=href;\n        return params;\n    },\n\n\n});\n"]}