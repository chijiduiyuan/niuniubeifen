{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\comp/assets\\scripts\\comp\\GameFinishUI.js"],"names":["cc","Class","extends","Component","properties","_args","info","Node","share","Button","follow","restart","close","onLoad","active","init","args","initView","self","roominfo","getChildByName","getComponent","Label","string","Grobal","roomNum","maxOfGame","i","playerList","length","player","uid","roomUser","userName","d","Date","startTime","getMonth","getDate","getHours","getMinutes","vv","uitools","addClickEvent","node","ShowUserInfo","user","first","name","userinfo","score","index","gameNetMgr","getSeatNodeByUid","seats","undefined","Sprite","spriteFrame","getUserIcon","onRestartClick","data","avatar","conf","inningsNum","status","socket","send","onCloseClick","sys","isNative","director","loadScene","window","location","href","onFollowClick","ShowAlert","getScene","onShareClick","hallSDK","goShare"],"mappings":"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","file":"GameFinishUI.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\comp","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        _args:null,\r\n        info:cc.Node,\r\n        share:cc.Button,\r\n        follow:cc.Button,\r\n        restart:cc.Button,\r\n        close:cc.Button,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.info.active = false;\r\n    },  \r\n\r\n    init:function(args){\r\n        this._args = args;\r\n        this.initView();\r\n    },\r\n\r\n    initView:function(){\r\n        var self = this\r\n        this.info.active = true;\r\n        var roominfo =self.info.getChildByName(\"roominfo\");\r\n        roominfo.getChildByName(\"roomnum\").getComponent(cc.Label).string = Grobal.roomNum;\r\n        roominfo.getChildByName(\"jushu\").getComponent(cc.Label).string = Grobal.maxOfGame;\r\n        for(var i=0;i<self._args.playerList.length;i++){\r\n            var player = self._args.playerList[i];\r\n            if(player.uid == Grobal.roomUser){\r\n                roominfo.getChildByName(\"roomuser\").getComponent(cc.Label).string = player.userName;\r\n            }\r\n        }\r\n        var d=new Date(Grobal.startTime);\r\n        roominfo.getChildByName(\"starttime\").getComponent(cc.Label).string = (d.getMonth()+1)+\"-\"+(d.getDate())+\" \"+(d.getHours())+\":\"+(d.getMinutes());\r\n        \r\n        cc.vv.uitools.addClickEvent(self.follow,this.node,\"GameFinishUI\",\"onFollowClick\"); \r\n        cc.vv.uitools.addClickEvent(self.share,this.node,\"GameFinishUI\",\"onShareClick\"); \r\n        cc.vv.uitools.addClickEvent(self.restart,this.node,\"GameFinishUI\",\"onRestartClick\"); \r\n        cc.vv.uitools.addClickEvent(self.close,this.node,\"GameFinishUI\",\"onCloseClick\"); \r\n        self.ShowUserInfo();\r\n    },\r\n\r\n    ShowUserInfo:function(){\r\n        var self = this;\r\n        var user = self.info.getChildByName(\"user\");\r\n        var first = self._args.playerList[0];\r\n        for(var i=0;i<self._args.playerList.length;i++){\r\n            var name = \"user\" + (i+1);\r\n            var userinfo = user.getChildByName(name);\r\n            var player = self._args.playerList[i];\r\n            userinfo.getChildByName(\"username\").getComponent(cc.Label).string = player.userName;\r\n             userinfo.getChildByName(\"id\").getComponent(cc.Label).string = player.uid;\r\n            var score = player.score;\r\n            userinfo.getChildByName(\"score\").getComponent(cc.Label).string = score;\r\n            userinfo.active = true;\r\n            if(i == 0){\r\n                userinfo.getChildByName(\"fangzhu\").active = true;\r\n            }\r\n            else if(first.score == score){\r\n                userinfo.getChildByName(\"fangzhu\").active = true;\r\n            }\r\n            else{\r\n                userinfo.getChildByName(\"fangzhu\").active = false;\r\n            }\r\n            var index = cc.vv.gameNetMgr.getSeatNodeByUid(player.uid);\r\n            if(cc.vv.gameNetMgr.seats[index] !== undefined){\r\n                userinfo.getChildByName(\"icon\").getComponent(cc.Sprite).spriteFrame = cc.vv.gameNetMgr.seats[index].getUserIcon();\r\n            }\r\n            userinfo.active = true;\r\n        }\r\n    },\r\n\r\n    onRestartClick: function () {\r\n        if(cc.args[\"ext\"] == undefined){\r\n            //{\"guipai\":\"0\",\"jiase\":\"0\",\"zuozhuang\":\"1\",\"playType\":\"fzwf\"}  本地调试，拿这个区encode\r\n           cc.args[\"ext\"] = \"%7b%22guipai%22%3a%220%22%2c%22playType%22%3a%22nor%22%2c%22zhuangType%22%3a%22turn%22%2c%22niu7%22%3a%22bei1%22%7d\"\r\n           // cc.args[\"ext\"] = \"%7b%22guipai%22%3a%220%22%2c%22jiase%22%3a%220%22%2c%22zuozhuang%22%3a%221%22%2c%22playType%22%3a%22fzwf%22%7d\"\r\n        }\r\n        if(cc.args[\"inningsNum\"] == undefined){\r\n            cc.args[\"inningsNum\"] = 4;\r\n        }\r\n        var data = {\r\n            uid:Grobal.uid,\r\n            userName:cc.args[\"userName\"],\r\n            avatar:cc.args[\"avatar\"],\r\n            roomNum:Grobal.roomNum,\r\n            conf:cc.args[\"ext\"],\r\n            inningsNum:cc.args[\"inningsNum\"],\r\n        }\r\n        Grobal.status = \"standup\";\r\n        cc.vv.socket.send('startagain',data);\r\n    },\r\n\r\n    onCloseClick: function () {\r\n         if(cc.sys.isNative){\r\n            cc.director.loadScene(\"web\");\r\n        }else{\r\n            window.location.href = \"/\";\r\n        }\r\n    },\r\n\r\n    onFollowClick: function () {\r\n         if(cc.sys.isNative){\r\n            cc.director.loadScene(\"web\");\r\n        }else{\r\n            cc.vv.uitools.ShowAlert(cc.director.getScene(),\"关注\",null,true);\r\n        }\r\n    },\r\n\r\n    onShareClick: function () {\r\n        cc.vv.hallSDK.goShare();\r\n    },\r\n\r\n});\r\n"]}